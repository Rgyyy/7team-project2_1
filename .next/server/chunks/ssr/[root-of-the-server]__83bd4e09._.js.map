{"version":3,"sources":["turbopack:///[project]/src/actions/userLogout.ts","turbopack:///[project]/src/lib/prisma.ts","turbopack:///[project]/src/actions/userAuth.ts","turbopack:///[project]/src/actions/userCallProfile.ts","turbopack:///[project]/.next-internal/server/app/chatting/page/actions.js (server actions loader)","turbopack:///[project]/src/app/chatting/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["\"use server\";\n\nimport { cookies } from \"next/headers\";\n\nexport async function logoutUser() {\n  try {\n    // 쿠키에서 토큰 제거\n    const cookieStore = await cookies();\n    cookieStore.delete(\"token\");\n\n    console.log(\"로그아웃 성공\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"로그아웃 에러:\", error);\n    return { success: false, error: \"로그아웃 중 오류가 발생했습니다.\" };\n  }\n}\n","\nimport { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query', 'error', 'warn'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;","\"use server\";\n\nimport { cookies } from \"next/headers\";\nimport jwt from \"jsonwebtoken\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function getUser() {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(\"token\")?.value;\n    if (!token) {\n      return null;\n    }\n    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as {\n      userId: string;\n    };\n    return decoded;\n  } catch (error) {\n    console.error(\"Error in getUser:\", error);\n    return null;\n  }\n}\n\nexport async function getUserName() {\n  try {\n    const user = await getUser();\n    if (!user) {\n      return null;\n    }\n    const userData = await prisma.user_data.findUnique({\n      where: {\n        user_id: user.userId,\n        user_state: \"0\", // 정상 회원만 조회\n      },\n      select: { user_name: true },\n    });\n    return userData?.user_name || null;\n  } catch (error) {\n    console.error(\"Error fetching user name:\", error);\n    return null;\n  }\n}\n\nexport async function getUserId() {\n  try {\n    const user = await getUser();\n    if (!user) {\n      return null;\n    }\n    const userData = await prisma.user_data.findUnique({\n      where: { user_id: user.userId },\n      select: { id: true },\n    });\n    return userData?.id || null;\n  } catch (error) {\n    console.error(\"Error fetching user name:\", error);\n    return null;\n  }\n}\n\nexport async function deleteUser() {\n  try {\n    const user = await getUser();\n    if (!user) {\n      return { success: false, error: \"로그인이 필요합니다.\" };\n    }\n\n    // user_state를 1로 변경하여 회원 탈퇴 처리\n    await prisma.user_data.update({\n      where: { user_id: user.userId },\n      data: { user_state: \"1\" },\n    });\n\n    // 쿠키에서 토큰 제거\n    const cookieStore = await cookies();\n    cookieStore.delete(\"token\");\n\n    return { success: true };\n  } catch (error) {\n    console.error(\"회원 탈퇴 오류:\", error);\n    return { success: false, error: \"회원 탈퇴 중 오류가 발생했습니다.\" };\n  }\n}\n","\"use server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { getUser } from \"@/actions/userAuth\";\n\nexport async function call_login_records() {\n  try {\n    const user = await getUser();\n    if (!user) return null;\n\n    const userData = await prisma.user_data.findUnique({\n      where: {\n        user_id: user.userId,\n        user_state: \"0\", // 정상 회원만 조회\n      },\n      select: {\n        user_id: true,\n        user_main_location: true,\n        user_name: true,\n        user_email: true,\n        login_records: {\n          select: {\n            id: true,\n            login_time: true,\n            login_location: true,\n            login_ip: true,\n            login_platform: true,\n          },\n          orderBy: { login_time: \"desc\" },\n          take: 5,\n        },\n        activities: {\n          select: {\n            id: true,\n            title: true,\n            difficultyLevel: true,\n            participants: true,\n            maxParticipants: true,\n            price: true,\n            date: true,\n            createdAt: true,\n          },\n          orderBy: { createdAt: \"desc\" },\n          take: 5,\n        },\n        participations: {\n          select: {\n            id: true,\n            activityId: true,\n            createdAt: true, // 가입날짜\n            activity: {\n              select: {\n                id: true,\n                title: true,\n                difficultyLevel: true,\n                participants: true,\n                maxParticipants: true,\n                price: true, // 참가비 추가\n                date: true, // 모임날짜 추가\n                createdAt: true, // 모임 생성날짜\n              },\n            },\n          },\n          orderBy: { createdAt: \"desc\" },\n          take: 5,\n        },\n      },\n    });\n    // console.log(userData);\n    return userData || null;\n  } catch (error) {\n    return null;\n  }\n}\n","export {logoutUser as '00d0b65cc6bfb399fbc62f4e926cf25cfa389ab386'} from 'ACTIONS_MODULE0'\nexport {call_login_records as '00bf62ec32653a359112d73db1efe597f16bae41c8'} from 'ACTIONS_MODULE1'\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/chatting/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/chatting/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"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","ignoreList":[5]}