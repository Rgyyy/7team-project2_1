{"version":3,"sources":["turbopack:///[project]/src/actions/userLogout.ts","turbopack:///[project]/src/lib/prisma.ts","turbopack:///[project]/src/actions/userAuth.ts","turbopack:///[project]/src/actions/userCallProfile.ts","turbopack:///[project]/.next-internal/server/app/chatting/page/actions.js (server actions loader)","turbopack:///[project]/src/app/chatting/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["\"use server\";\r\n\r\nimport { cookies } from \"next/headers\";\r\n\r\nexport async function logoutUser() {\r\n  try {\r\n    // 쿠키에서 토큰 제거\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(\"token\");\r\n\r\n    console.log(\"로그아웃 성공\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"로그아웃 에러:\", error);\r\n    return { success: false, error: \"로그아웃 중 오류가 발생했습니다.\" };\r\n  }\r\n}\r\n","\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: ['query', 'error', 'warn'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;","\"use server\";\r\n\r\nimport { cookies } from \"next/headers\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport async function getUser() {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    const token = cookieStore.get(\"token\")?.value;\r\n    if (!token) {\r\n      return null;\r\n    }\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as {\r\n      userId: string;\r\n    };\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error(\"Error in getUser:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getUserName() {\r\n  try {\r\n    const user = await getUser();\r\n    if (!user) {\r\n      return null;\r\n    }\r\n    const userData = await prisma.user_data.findUnique({\r\n      where: {\r\n        user_id: user.userId,\r\n        user_state: \"0\", // 정상 회원만 조회\r\n      },\r\n      select: { user_name: true },\r\n    });\r\n    return userData?.user_name || null;\r\n  } catch (error) {\r\n    console.error(\"Error fetching user name:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getUserId() {\r\n  try {\r\n    const user = await getUser();\r\n    if (!user) {\r\n      return null;\r\n    }\r\n    const userData = await prisma.user_data.findUnique({\r\n      where: { user_id: user.userId },\r\n      select: { id: true },\r\n    });\r\n    return userData?.id || null;\r\n  } catch (error) {\r\n    console.error(\"Error fetching user name:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteUser() {\r\n  try {\r\n    const user = await getUser();\r\n    if (!user) {\r\n      return { success: false, error: \"로그인이 필요합니다.\" };\r\n    }\r\n\r\n    // user_state를 1로 변경하여 회원 탈퇴 처리\r\n    await prisma.user_data.update({\r\n      where: { user_id: user.userId },\r\n      data: { user_state: \"1\" },\r\n    });\r\n\r\n    // 쿠키에서 토큰 제거\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(\"token\");\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"회원 탈퇴 오류:\", error);\r\n    return { success: false, error: \"회원 탈퇴 중 오류가 발생했습니다.\" };\r\n  }\r\n}\r\n","\"use server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { getUser } from \"@/actions/userAuth\";\r\n\r\nexport async function call_login_records() {\r\n  try {\r\n    const user = await getUser();\r\n    if (!user) return null;\r\n\r\n    const userData = await prisma.user_data.findUnique({\r\n      where: {\r\n        user_id: user.userId,\r\n        user_state: \"0\", // 정상 회원만 조회\r\n      },\r\n      select: {\r\n        user_id: true,\r\n        user_main_location: true,\r\n        user_name: true,\r\n        user_email: true,\r\n        login_records: {\r\n          select: {\r\n            id: true,\r\n            login_time: true,\r\n            login_location: true,\r\n            login_ip: true,\r\n            login_platform: true,\r\n          },\r\n          orderBy: { login_time: \"desc\" },\r\n          take: 5,\r\n        },\r\n        activities: {\r\n          select: {\r\n            id: true,\r\n            title: true,\r\n            difficultyLevel: true,\r\n            participants: true,\r\n            maxParticipants: true,\r\n            price: true,\r\n            date: true,\r\n            createdAt: true,\r\n          },\r\n          orderBy: { createdAt: \"desc\" },\r\n          take: 5,\r\n        },\r\n        participations: {\r\n          select: {\r\n            id: true,\r\n            activityId: true,\r\n            createdAt: true, // 가입날짜\r\n            activity: {\r\n              select: {\r\n                id: true,\r\n                title: true,\r\n                difficultyLevel: true,\r\n                participants: true,\r\n                maxParticipants: true,\r\n                price: true, // 참가비 추가\r\n                date: true, // 모임날짜 추가\r\n                createdAt: true, // 모임 생성날짜\r\n              },\r\n            },\r\n          },\r\n          orderBy: { createdAt: \"desc\" },\r\n          take: 5,\r\n        },\r\n      },\r\n    });\r\n    // console.log(userData);\r\n    return userData || null;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n","export {logoutUser as '00b7a57c14b2684975b2c912dfa8f62e85d5d7f389'} from 'ACTIONS_MODULE0'\nexport {call_login_records as '005eedc454307c5e6bb44211c701593d64fc84271f'} from 'ACTIONS_MODULE1'\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/chatting/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/chatting/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"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","ignoreList":[5]}