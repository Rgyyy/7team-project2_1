{"version":3,"sources":["turbopack:///[project]/src/actions/userLogout.ts","turbopack:///[project]/src/lib/prisma.ts","turbopack:///[project]/src/actions/userDataCall.ts","turbopack:///[project]/src/app/create-activity/page.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/.next-internal/server/app/create-activity/page/actions.js (server actions loader)","turbopack:///[project]/src/app/actions/activity.ts"],"sourcesContent":["\"use server\";\n\nimport { cookies } from \"next/headers\";\n\nexport async function logoutUser() {\n  try {\n    // 쿠키에서 토큰 제거\n    const cookieStore = await cookies();\n    cookieStore.delete(\"token\");\n\n    console.log(\"로그아웃 성공\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"로그아웃 에러:\", error);\n    return { success: false, error: \"로그아웃 중 오류가 발생했습니다.\" };\n  }\n}\n","\nimport { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query', 'error', 'warn'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;","\"use server\";\n\nimport { cookies } from \"next/headers\";\nimport jwt from \"jsonwebtoken\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function getUser() {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(\"token\")?.value;\n    if (!token) {\n      return null;\n    }\n    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as {\n      userId: string;\n    };\n    \n    // ✅ user_id로 user_data 찾아서 실제 id 반환\n    const userData = await prisma.user_data.findUnique({\n      where: { user_id: decoded.userId },\n      select: { \n        id: true,           // ← 이게 중요!\n        user_name: true,\n        user_email: true,\n      },\n    });\n    \n    if (!userData) {\n      return null;\n    }\n    \n    return {\n      userId: userData.id,  // ✅ user_data.id 반환 (user_id 아님!)\n      userName: userData.user_name,\n      userEmail: userData.user_email,\n    };\n  } catch (error) {\n    console.error(\"Error in getUser:\", error);\n    return null;\n  }\n}\n\nexport async function getUserName() {\n  try {\n    const user = await getUser();\n    if (!user) {\n      return null;\n    }\n    return user.userName || null;\n  } catch (error) {\n    console.error(\"Error fetching user name:\", error);\n    return null;\n  }\n}","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/create-activity/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/create-activity/page.tsx\",\n    \"default\",\n);\n","export {logoutUser as '00382cd68f3bd744983f7d813af84c482d62770930'} from 'ACTIONS_MODULE0'\nexport {createActivity as '40b51f7edf0ec5d695698f13d5650d24a2af78dce4'} from 'ACTIONS_MODULE1'\n","\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath } from \"next/cache\";\nimport { getUser } from \"@/actions/userDataCall\";\n\ninterface ActivityData {\n  title: string;\n  category: string;\n  description: string;\n  date: string;\n  time: string;\n  location: string;\n  address: string;\n  duration: string;\n  maxParticipants: string;\n  difficultyLevel: string;\n  price: string;\n  organizer: string;\n  phone: string;\n  email: string;\n}\n\nexport async function createActivity(data: ActivityData) {\n  try {\n    // 로그인 확인\n    const user = await getUser();\n\n    console.log(\"User from getUser():\", user);\n\n    if (!user?.userId) {\n      return { success: false, error: \"로그인이 필요합니다.\" };\n    }\n\n    // 카테고리 찾기\n    const category = await prisma.category.findUnique({\n      where: { name: data.category },\n    });\n\n    if (!category) {\n      return { success: false, error: \"유효하지 않은 카테고리입니다.\" };\n    }\n\n    // 지역 찾기\n    const location = await prisma.location.findUnique({\n      where: { name: data.location },\n    });\n\n    if (!location) {\n      return { success: false, error: \"유효하지 않은 지역입니다.\" };\n    }\n\n    console.log(\"Creating activity with userId:\", user.userId);\n    console.log(\"Category ID:\", category.id);\n    console.log(\"Location ID:\", location.id);\n\n    // 활동(모임) 생성\n    const activity = await prisma.activity.create({\n      data: {\n        title: data.title,\n        description: data.description,\n        date: data.date,\n        time: data.time,\n        address: data.address,\n        duration: parseInt(data.duration),\n        maxParticipants: parseInt(data.maxParticipants),\n        difficultyLevel: data.difficultyLevel,\n        price: parseInt(data.price || \"0\"),\n        organizer: data.organizer,\n        phone: data.phone,\n        email: data.email,\n        categoryId: category.id,\n        locationId: location.id,\n        userId: user.userId, // 작성자 ID 추가\n      },\n      include: {\n        category: true,\n        location: true,\n      },\n    });\n\n    // // Participation에 작성자(userId) 추가 이주한 25/11/12\n    // // 에러 발생으로 제외 25.11.13. 17:01\n    // await prisma.participation.create({\n    //   data: {\n    //     activityId: activity.id,\n    //     userId: user.userId,\n    //   },\n    // });\n\n    // 캐시 갱신\n    revalidatePath(\"/activities\");\n\n    return { success: true, data: activity };\n  } catch (error) {\n    console.error(\"Activity creation error:\", error);\n    return { success: false, error: \"모임 생성에 실패했습니다.\" };\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[3]}