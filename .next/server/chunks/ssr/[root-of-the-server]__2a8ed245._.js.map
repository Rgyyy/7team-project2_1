<<<<<<< HEAD
{"version":3,"sources":["turbopack:///[project]/src/component/PostFormWithUpload.tsx","turbopack:///[project]/src/actions/data:fd1c36 <text/javascript>"],"sourcesContent":["// src/component/PostFormWithUpload.tsx\r\n\"use client\";\r\n\r\nimport { useState, useTransition } from \"react\";\r\nimport { createPost } from \"@/actions/createPost\";\r\nimport { MoimPostCat } from \"@prisma/client\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ntype Props = {\r\n  activityId: string;\r\n};\r\n\r\nexport default function PostFormWithUpload({ activityId }: Props) {\r\n  const router = useRouter();\r\n  const [isPending, startTransition] = useTransition();\r\n\r\n  // ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ìƒíƒœ\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [preview, setPreview] = useState(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadedUrl, setUploadedUrl] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [formError, setFormError] = useState(\"\");\r\n\r\n  // íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n\r\n    if (!file) {\r\n      return;\r\n    }\r\n\r\n    // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB ì œí•œ)\r\n    const maxSize = 5 * 1024 * 1024;\r\n    if (file.size > maxSize) {\r\n      setError(\"íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤\");\r\n      return;\r\n    }\r\n\r\n    // íŒŒì¼ íƒ€ì… ì²´í¬ (ì´ë¯¸ì§€ë§Œ í—ˆìš©)\r\n    if (!file.type.startsWith(\"image/\")) {\r\n      setError(\"ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\");\r\n      return;\r\n    }\r\n\r\n    setError(\"\");\r\n    setSelectedFile(file);\r\n\r\n    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      setPreview(reader.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  // ì´ë¯¸ì§€ ì„ íƒ ì´ˆê¸°í™”\r\n  const handleReset = () => {\r\n    setSelectedFile(null);\r\n    setPreview(\"\");\r\n    setUploadedUrl(\"\");\r\n    setError(\"\");\r\n  };\r\n\r\n  // í¼ ì œì¶œ í•¸ë“¤ëŸ¬\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setFormError(\"\");\r\n\r\n    const form = e.currentTarget;\r\n    const formData = new FormData(form);\r\n\r\n    // ì´ë¯¸ì§€ê°€ ì„ íƒë˜ì—ˆì§€ë§Œ ì•„ì§ ì—…ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš°\r\n    if (selectedFile && !uploadedUrl) {\r\n      setUploading(true);\r\n      setError(\"\");\r\n\r\n      try {\r\n        const uploadFormData = new FormData();\r\n        uploadFormData.append(\"file\", selectedFile);\r\n\r\n        const response = await fetch(\"/api/upload\", {\r\n          method: \"POST\",\r\n          body: uploadFormData,\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(\"ì—…ë¡œë“œ ì‹¤íŒ¨\");\r\n        }\r\n\r\n        const data = await response.json();\r\n        setUploadedUrl(data.url);\r\n\r\n        // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì„ í¼ ë°ì´í„°ì— ì¶”ê°€\r\n        formData.append(\"imageUrl\", data.url);\r\n      } catch (err) {\r\n        setError(\"ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\");\r\n        console.error(err);\r\n        setUploading(false);\r\n        return;\r\n      } finally {\r\n        setUploading(false);\r\n      }\r\n    } else if (uploadedUrl) {\r\n      // ì´ë¯¸ ì—…ë¡œë“œëœ ê²½ìš°\r\n      formData.append(\"imageUrl\", uploadedUrl);\r\n    }\r\n\r\n    // Server Action í˜¸ì¶œ\r\n    startTransition(async () => {\r\n      try {\r\n        const result = await createPost(activityId, null, formData);\r\n\r\n        if (result?.error) {\r\n          setFormError(result.error);\r\n        }\r\n        // redirectëŠ” createPost ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ë¨\r\n      } catch (err) {\r\n        console.error(err);\r\n        setFormError(\"ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\");\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-6\">ê²Œì‹œê¸€ ì‘ì„±</h1>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {/* ì¹´í…Œê³ ë¦¬ ì„ íƒ */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">ì¹´í…Œê³ ë¦¬</label>\r\n          <select\r\n            name=\"category\"\r\n            className=\"w-full px-4 py-2 border rounded-lg\"\r\n            required\r\n          >\r\n            <option value=\"\">ì„ íƒí•˜ì„¸ìš”</option>\r\n            <option value={MoimPostCat.ëª¨ì„í›„ê¸°}>ğŸ“¸ ëª¨ì„í›„ê¸°</option>\r\n            <option value={MoimPostCat.ê°€ì…ì¸ì‚¬}>ğŸ‘‹ ê°€ì…ì¸ì‚¬</option>\r\n            <option value={MoimPostCat.ììœ }>ğŸ’¬ ììœ </option>\r\n            <option value={MoimPostCat.ê³µì§€}>ğŸ“¢ ê³µì§€</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* ì œëª© */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">ì œëª©</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"title\"\r\n            className=\"w-full px-4 py-2 border rounded-lg\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">\r\n            ì´ë¯¸ì§€ ì²¨ë¶€ (ì„ íƒ)\r\n          </label>\r\n          <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6\">\r\n            {!preview ? (\r\n              // íŒŒì¼ ì„ íƒ ì „\r\n              <div className=\"text-center\">\r\n                <svg\r\n                  className=\"mx-auto h-12 w-12 text-gray-400 mb-4\"\r\n                  stroke=\"currentColor\"\r\n                  fill=\"none\"\r\n                  viewBox=\"0 0 48 48\"\r\n                >\r\n                  <path\r\n                    d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\"\r\n                    strokeWidth=\"2\"\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                  />\r\n                </svg>\r\n\r\n                <label className=\"cursor-pointer\">\r\n                  <span className=\"text-blue-500 hover:text-blue-600 font-medium\">\r\n                    íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”\r\n                  </span>\r\n                  <input\r\n                    type=\"file\"\r\n                    className=\"hidden\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleFileSelect}\r\n                  />\r\n                </label>\r\n\r\n                <p className=\"text-xs text-gray-400 mt-1\">\r\n                  PNG, JPG, GIF (ìµœëŒ€ 5MB)\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              // ë¯¸ë¦¬ë³´ê¸°\r\n              <div>\r\n                <img\r\n                  src={preview}\r\n                  alt=\"ë¯¸ë¦¬ë³´ê¸°\"\r\n                  className=\"max-h-64 mx-auto rounded\"\r\n                />\r\n\r\n                {selectedFile && (\r\n                  <div className=\"mt-4 text-sm text-gray-600 text-center\">\r\n                    <p>íŒŒì¼ëª…: {selectedFile.name}</p>\r\n                    <p>í¬ê¸°: {(selectedFile.size / 1024).toFixed(2)} KB</p>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"mt-4 flex gap-2 justify-center\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleReset}\r\n                    className=\"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400\"\r\n                  >\r\n                    ì´ë¯¸ì§€ ì œê±°\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬ */}\r\n          {error && (\r\n            <div className=\"mt-2 p-3 bg-red-100 text-red-700 rounded text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/* ì—…ë¡œë“œ ì™„ë£Œ */}\r\n          {uploadedUrl && (\r\n            <div className=\"mt-2 p-4 bg-green-100 rounded\">\r\n              <p className=\"text-green-700 font-medium mb-2\">ì—…ë¡œë“œ ì™„ë£Œ!</p>\r\n              <img\r\n                src={uploadedUrl}\r\n                alt=\"ì—…ë¡œë“œëœ ì´ë¯¸ì§€\"\r\n                className=\"mt-2 max-h-32 rounded\"\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ */}\r\n          {uploading && (\r\n            <div className=\"mt-2\">\r\n              <div className=\"bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-blue-500 h-2 rounded-full animate-pulse\"\r\n                  style={{ width: \"70%\" }}\r\n                ></div>\r\n              </div>\r\n              <p className=\"text-sm text-gray-600 mt-2 text-center\">\r\n                ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* ë‚´ìš© */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">ë‚´ìš©</label>\r\n          <textarea\r\n            name=\"content\"\r\n            rows={10}\r\n            className=\"w-full px-4 py-2 border rounded-lg\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        {/* í¼ ì—ëŸ¬ ë©”ì‹œì§€ */}\r\n        {formError && (\r\n          <div className=\"text-red-600 text-sm bg-red-50 p-3 rounded\">\r\n            {formError}\r\n          </div>\r\n        )}\r\n\r\n        {/* ì œì¶œ ë²„íŠ¼ */}\r\n        <button\r\n          type=\"submit\"\r\n          disabled={uploading || isPending}\r\n          className=\"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n        >\r\n          {uploading\r\n            ? \"ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...\"\r\n            : isPending\r\n            ? \"ì‘ì„± ì¤‘...\"\r\n            : \"ì‘ì„±í•˜ê¸°\"}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","/* __next_internal_action_entry_do_not_use__ [{\"7008b151044865d41949dee997c4a21031a45bff04\":\"createPost\"},\"src/actions/createPost.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var createPost=/*#__PURE__*/createServerReference(\"7008b151044865d41949dee997c4a21031a45bff04\",callServer,void 0,findSourceMapURL,\"createPost\");"],"names":[],"mappings":"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"}
=======
{"version":3,"sources":["turbopack:///[project]/src/component/PostFormWithUpload.tsx","turbopack:///[project]/src/actions/data:f5f89a <text/javascript>"],"sourcesContent":["// src/component/PostFormWithUpload.tsx\n\"use client\";\n\nimport { useState, useTransition } from \"react\";\nimport { createPost } from \"@/actions/createPost\";\nimport { MoimPostCat } from \"@prisma/client\";\nimport { useRouter } from \"next/navigation\";\n\ntype Props = {\n  activityId: string;\n};\n\nexport default function PostFormWithUpload({ activityId }: Props) {\n  const router = useRouter();\n  const [isPending, startTransition] = useTransition();\n\n  // ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ìƒíƒœ\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n  const [uploadedUrl, setUploadedUrl] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [formError, setFormError] = useState(\"\");\n\n  // íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n\n    if (!file) {\n      return;\n    }\n\n    // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB ì œí•œ)\n    const maxSize = 5 * 1024 * 1024;\n    if (file.size > maxSize) {\n      setError(\"íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤\");\n      return;\n    }\n\n    // íŒŒì¼ íƒ€ì… ì²´í¬ (ì´ë¯¸ì§€ë§Œ í—ˆìš©)\n    if (!file.type.startsWith(\"image/\")) {\n      setError(\"ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\");\n      return;\n    }\n\n    setError(\"\");\n    setSelectedFile(file);\n\n    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // ì´ë¯¸ì§€ ì„ íƒ ì´ˆê¸°í™”\n  const handleReset = () => {\n    setSelectedFile(null);\n    setPreview(\"\");\n    setUploadedUrl(\"\");\n    setError(\"\");\n  };\n\n  // í¼ ì œì¶œ í•¸ë“¤ëŸ¬\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setFormError(\"\");\n\n    const form = e.currentTarget;\n    const formData = new FormData(form);\n\n    // ì´ë¯¸ì§€ê°€ ì„ íƒë˜ì—ˆì§€ë§Œ ì•„ì§ ì—…ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš°\n    if (selectedFile && !uploadedUrl) {\n      setUploading(true);\n      setError(\"\");\n\n      try {\n        const uploadFormData = new FormData();\n        uploadFormData.append(\"file\", selectedFile);\n\n        const response = await fetch(\"/api/upload\", {\n          method: \"POST\",\n          body: uploadFormData,\n        });\n\n        if (!response.ok) {\n          throw new Error(\"ì—…ë¡œë“œ ì‹¤íŒ¨\");\n        }\n\n        const data = await response.json();\n        setUploadedUrl(data.url);\n\n        // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì„ í¼ ë°ì´í„°ì— ì¶”ê°€\n        formData.append(\"imageUrl\", data.url);\n      } catch (err) {\n        setError(\"ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\");\n        console.error(err);\n        setUploading(false);\n        return;\n      } finally {\n        setUploading(false);\n      }\n    } else if (uploadedUrl) {\n      // ì´ë¯¸ ì—…ë¡œë“œëœ ê²½ìš°\n      formData.append(\"imageUrl\", uploadedUrl);\n    }\n\n    // Server Action í˜¸ì¶œ\n    startTransition(async () => {\n      try {\n        const result = await createPost(activityId, null, formData);\n\n        if (result?.error) {\n          setFormError(result.error);\n        }\n        // redirectëŠ” createPost ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ë¨\n      } catch (err) {\n        console.error(err);\n        setFormError(\"ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\");\n      }\n    });\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-6\">\n      <h1 className=\"text-2xl font-bold mb-6\">ê²Œì‹œê¸€ ì‘ì„±</h1>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {/* ì¹´í…Œê³ ë¦¬ ì„ íƒ */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">ì¹´í…Œê³ ë¦¬</label>\n          <select\n            name=\"category\"\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          >\n            <option value=\"\">ì„ íƒí•˜ì„¸ìš”</option>\n            <option value={MoimPostCat.ëª¨ì„í›„ê¸°}>ğŸ“¸ ëª¨ì„í›„ê¸°</option>\n            <option value={MoimPostCat.ê°€ì…ì¸ì‚¬}>ğŸ‘‹ ê°€ì…ì¸ì‚¬</option>\n            <option value={MoimPostCat.ììœ }>ğŸ’¬ ììœ </option>\n            <option value={MoimPostCat.ê³µì§€}>ğŸ“¢ ê³µì§€</option>\n          </select>\n        </div>\n\n        {/* ì œëª© */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">ì œëª©</label>\n          <input\n            type=\"text\"\n            name=\"title\"\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          />\n        </div>\n\n        {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">\n            ì´ë¯¸ì§€ ì²¨ë¶€ (ì„ íƒ)\n          </label>\n          <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6\">\n            {!preview ? (\n              // íŒŒì¼ ì„ íƒ ì „\n              <div className=\"text-center\">\n                <svg\n                  className=\"mx-auto h-12 w-12 text-gray-400 mb-4\"\n                  stroke=\"currentColor\"\n                  fill=\"none\"\n                  viewBox=\"0 0 48 48\"\n                >\n                  <path\n                    d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  />\n                </svg>\n\n                <label className=\"cursor-pointer\">\n                  <span className=\"text-blue-500 hover:text-blue-600 font-medium\">\n                    íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”\n                  </span>\n                  <input\n                    type=\"file\"\n                    className=\"hidden\"\n                    accept=\"image/*\"\n                    onChange={handleFileSelect}\n                  />\n                </label>\n\n                <p className=\"text-xs text-gray-400 mt-1\">\n                  PNG, JPG, GIF (ìµœëŒ€ 5MB)\n                </p>\n              </div>\n            ) : (\n              // ë¯¸ë¦¬ë³´ê¸°\n              <div>\n                <img\n                  src={preview}\n                  alt=\"ë¯¸ë¦¬ë³´ê¸°\"\n                  className=\"max-h-64 mx-auto rounded\"\n                />\n\n                {selectedFile && (\n                  <div className=\"mt-4 text-sm text-gray-600 text-center\">\n                    <p>íŒŒì¼ëª…: {selectedFile.name}</p>\n                    <p>í¬ê¸°: {(selectedFile.size / 1024).toFixed(2)} KB</p>\n                  </div>\n                )}\n\n                <div className=\"mt-4 flex gap-2 justify-center\">\n                  <button\n                    type=\"button\"\n                    onClick={handleReset}\n                    className=\"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400\"\n                  >\n                    ì´ë¯¸ì§€ ì œê±°\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬ */}\n          {error && (\n            <div className=\"mt-2 p-3 bg-red-100 text-red-700 rounded text-sm\">\n              {error}\n            </div>\n          )}\n\n          {/* ì—…ë¡œë“œ ì™„ë£Œ */}\n          {uploadedUrl && (\n            <div className=\"mt-2 p-4 bg-green-100 rounded\">\n              <p className=\"text-green-700 font-medium mb-2\">ì—…ë¡œë“œ ì™„ë£Œ!</p>\n              <img\n                src={uploadedUrl}\n                alt=\"ì—…ë¡œë“œëœ ì´ë¯¸ì§€\"\n                className=\"mt-2 max-h-32 rounded\"\n              />\n            </div>\n          )}\n\n          {/* ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ */}\n          {uploading && (\n            <div className=\"mt-2\">\n              <div className=\"bg-gray-200 rounded-full h-2\">\n                <div\n                  className=\"bg-blue-500 h-2 rounded-full animate-pulse\"\n                  style={{ width: \"70%\" }}\n                ></div>\n              </div>\n              <p className=\"text-sm text-gray-600 mt-2 text-center\">\n                ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* ë‚´ìš© */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">ë‚´ìš©</label>\n          <textarea\n            name=\"content\"\n            rows={10}\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          />\n        </div>\n\n        {/* í¼ ì—ëŸ¬ ë©”ì‹œì§€ */}\n        {formError && (\n          <div className=\"text-red-600 text-sm bg-red-50 p-3 rounded\">\n            {formError}\n          </div>\n        )}\n\n        {/* ì œì¶œ ë²„íŠ¼ */}\n        <button\n          type=\"submit\"\n          disabled={uploading || isPending}\n          className=\"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed\"\n        >\n          {uploading\n            ? \"ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...\"\n            : isPending\n            ? \"ì‘ì„± ì¤‘...\"\n            : \"ì‘ì„±í•˜ê¸°\"}\n        </button>\n      </form>\n    </div>\n  );\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"70cafd612c44b7f03c5e6c82eabbec5209ad8a0556\":\"createPost\"},\"src/actions/createPost.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var createPost=/*#__PURE__*/createServerReference(\"70cafd612c44b7f03c5e6c82eabbec5209ad8a0556\",callServer,void 0,findSourceMapURL,\"createPost\");"],"names":[],"mappings":"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"}
>>>>>>> 570a0895651a0c8b7957032c0da71e2207c4ee5e
