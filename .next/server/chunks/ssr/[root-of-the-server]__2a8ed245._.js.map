{"version":3,"sources":["turbopack:///[project]/src/component/PostFormWithUpload.tsx","turbopack:///[project]/src/actions/data:689581 <text/javascript>"],"sourcesContent":["// src/component/PostFormWithUpload.tsx\n\"use client\";\n\nimport { useState, useTransition } from \"react\";\nimport { createPost } from \"@/actions/createPost\";\nimport { MoimPostCat } from \"@prisma/client\";\nimport { useRouter } from \"next/navigation\";\n\ntype Props = {\n  activityId: string;\n};\n\nexport default function PostFormWithUpload({ activityId }: Props) {\n  const router = useRouter();\n  const [isPending, startTransition] = useTransition();\n\n  // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Í¥ÄÎ†® ÏÉÅÌÉú\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n  const [uploadedUrl, setUploadedUrl] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [formError, setFormError] = useState(\"\");\n\n  // ÌååÏùº ÏÑ†ÌÉù Ìï∏Îì§Îü¨\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n\n    if (!file) {\n      return;\n    }\n\n    // ÌååÏùº ÌÅ¨Í∏∞ Ï≤¥ÌÅ¨ (5MB Ï†úÌïú)\n    const maxSize = 5 * 1024 * 1024;\n    if (file.size > maxSize) {\n      setError(\"ÌååÏùº ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§\");\n      return;\n    }\n\n    // ÌååÏùº ÌÉÄÏûÖ Ï≤¥ÌÅ¨ (Ïù¥ÎØ∏ÏßÄÎßå ÌóàÏö©)\n    if (!file.type.startsWith(\"image/\")) {\n      setError(\"Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§\");\n      return;\n    }\n\n    setError(\"\");\n    setSelectedFile(file);\n\n    // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉùÏÑ±\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî\n  const handleReset = () => {\n    setSelectedFile(null);\n    setPreview(\"\");\n    setUploadedUrl(\"\");\n    setError(\"\");\n  };\n\n  // Ìèº Ï†úÏ∂ú Ìï∏Îì§Îü¨\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setFormError(\"\");\n\n    const form = e.currentTarget;\n    const formData = new FormData(form);\n\n    // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÑ†ÌÉùÎêòÏóàÏßÄÎßå ÏïÑÏßÅ ÏóÖÎ°úÎìúÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞\n    if (selectedFile && !uploadedUrl) {\n      setUploading(true);\n      setError(\"\");\n\n      try {\n        const uploadFormData = new FormData();\n        uploadFormData.append(\"file\", selectedFile);\n\n        const response = await fetch(\"/api/upload\", {\n          method: \"POST\",\n          body: uploadFormData,\n        });\n\n        if (!response.ok) {\n          throw new Error(\"ÏóÖÎ°úÎìú Ïã§Ìå®\");\n        }\n\n        const data = await response.json();\n        setUploadedUrl(data.url);\n\n        // ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ URLÏùÑ Ìèº Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä\n        formData.append(\"imageUrl\", data.url);\n      } catch (err) {\n        setError(\"Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");\n        console.error(err);\n        setUploading(false);\n        return;\n      } finally {\n        setUploading(false);\n      }\n    } else if (uploadedUrl) {\n      // Ïù¥ÎØ∏ ÏóÖÎ°úÎìúÎêú Í≤ΩÏö∞\n      formData.append(\"imageUrl\", uploadedUrl);\n    }\n\n    // Server Action Ìò∏Ï∂ú\n    startTransition(async () => {\n      try {\n        const result = await createPost(activityId, null, formData);\n\n        if (result?.error) {\n          setFormError(result.error);\n        }\n        // redirectÎäî createPost ÎÇ¥Î∂ÄÏóêÏÑú Ï≤òÎ¶¨Îê®\n      } catch (err) {\n        console.error(err);\n        setFormError(\"Í≤åÏãúÍ∏Ä ÏûëÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");\n      }\n    });\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-6\">\n      <h1 className=\"text-2xl font-bold mb-6\">Í≤åÏãúÍ∏Ä ÏûëÏÑ±</h1>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {/* Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">Ïπ¥ÌÖåÍ≥†Î¶¨</label>\n          <select\n            name=\"category\"\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          >\n            <option value=\"\">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>\n            <option value={MoimPostCat.Î™®ÏûÑÌõÑÍ∏∞}>üì∏ Î™®ÏûÑÌõÑÍ∏∞</option>\n            <option value={MoimPostCat.Í∞ÄÏûÖÏù∏ÏÇ¨}>üëã Í∞ÄÏûÖÏù∏ÏÇ¨</option>\n            <option value={MoimPostCat.ÏûêÏú†}>üí¨ ÏûêÏú†</option>\n            <option value={MoimPostCat.Í≥µÏßÄ}>üì¢ Í≥µÏßÄ</option>\n          </select>\n        </div>\n\n        {/* Ï†úÎ™© */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">Ï†úÎ™©</label>\n          <input\n            type=\"text\"\n            name=\"title\"\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          />\n        </div>\n\n        {/* Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏòÅÏó≠ */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">\n            Ïù¥ÎØ∏ÏßÄ Ï≤®Î∂Ä (ÏÑ†ÌÉù)\n          </label>\n          <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6\">\n            {!preview ? (\n              // ÌååÏùº ÏÑ†ÌÉù Ï†Ñ\n              <div className=\"text-center\">\n                <svg\n                  className=\"mx-auto h-12 w-12 text-gray-400 mb-4\"\n                  stroke=\"currentColor\"\n                  fill=\"none\"\n                  viewBox=\"0 0 48 48\"\n                >\n                  <path\n                    d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\"\n                    strokeWidth=\"2\"\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                  />\n                </svg>\n\n                <label className=\"cursor-pointer\">\n                  <span className=\"text-blue-500 hover:text-blue-600 font-medium\">\n                    ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî\n                  </span>\n                  <input\n                    type=\"file\"\n                    className=\"hidden\"\n                    accept=\"image/*\"\n                    onChange={handleFileSelect}\n                  />\n                </label>\n\n                <p className=\"text-xs text-gray-400 mt-1\">\n                  PNG, JPG, GIF (ÏµúÎåÄ 5MB)\n                </p>\n              </div>\n            ) : (\n              // ÎØ∏Î¶¨Î≥¥Í∏∞\n              <div>\n                <img\n                  src={preview}\n                  alt=\"ÎØ∏Î¶¨Î≥¥Í∏∞\"\n                  className=\"max-h-64 mx-auto rounded\"\n                />\n\n                {selectedFile && (\n                  <div className=\"mt-4 text-sm text-gray-600 text-center\">\n                    <p>ÌååÏùºÎ™Ö: {selectedFile.name}</p>\n                    <p>ÌÅ¨Í∏∞: {(selectedFile.size / 1024).toFixed(2)} KB</p>\n                  </div>\n                )}\n\n                <div className=\"mt-4 flex gap-2 justify-center\">\n                  <button\n                    type=\"button\"\n                    onClick={handleReset}\n                    className=\"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400\"\n                  >\n                    Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏóêÎü¨ */}\n          {error && (\n            <div className=\"mt-2 p-3 bg-red-100 text-red-700 rounded text-sm\">\n              {error}\n            </div>\n          )}\n\n          {/* ÏóÖÎ°úÎìú ÏôÑÎ£å */}\n          {uploadedUrl && (\n            <div className=\"mt-2 p-4 bg-green-100 rounded\">\n              <p className=\"text-green-700 font-medium mb-2\">ÏóÖÎ°úÎìú ÏôÑÎ£å!</p>\n              <img\n                src={uploadedUrl}\n                alt=\"ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ\"\n                className=\"mt-2 max-h-32 rounded\"\n              />\n            </div>\n          )}\n\n          {/* ÏóÖÎ°úÎìú ÏßÑÌñâ ÏÉÅÌÉú */}\n          {uploading && (\n            <div className=\"mt-2\">\n              <div className=\"bg-gray-200 rounded-full h-2\">\n                <div\n                  className=\"bg-blue-500 h-2 rounded-full animate-pulse\"\n                  style={{ width: \"70%\" }}\n                ></div>\n              </div>\n              <p className=\"text-sm text-gray-600 mt-2 text-center\">\n                Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ë...\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* ÎÇ¥Ïö© */}\n        <div>\n          <label className=\"block text-sm font-medium mb-2\">ÎÇ¥Ïö©</label>\n          <textarea\n            name=\"content\"\n            rows={10}\n            className=\"w-full px-4 py-2 border rounded-lg\"\n            required\n          />\n        </div>\n\n        {/* Ìèº ÏóêÎü¨ Î©îÏãúÏßÄ */}\n        {formError && (\n          <div className=\"text-red-600 text-sm bg-red-50 p-3 rounded\">\n            {formError}\n          </div>\n        )}\n\n        {/* Ï†úÏ∂ú Î≤ÑÌäº */}\n        <button\n          type=\"submit\"\n          disabled={uploading || isPending}\n          className=\"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed\"\n        >\n          {uploading\n            ? \"Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï§ë...\"\n            : isPending\n            ? \"ÏûëÏÑ± Ï§ë...\"\n            : \"ÏûëÏÑ±ÌïòÍ∏∞\"}\n        </button>\n      </form>\n    </div>\n  );\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"7003775911154544dd89e525b09762c3a53a953496\":\"createPost\"},\"src/actions/createPost.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";export var createPost=/*#__PURE__*/createServerReference(\"7003775911154544dd89e525b09762c3a53a953496\",callServer,void 0,findSourceMapURL,\"createPost\");"],"names":[],"mappings":"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"}