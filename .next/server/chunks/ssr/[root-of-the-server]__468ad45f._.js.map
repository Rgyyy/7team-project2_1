{"version":3,"sources":["turbopack:///[project]/src/actions/userLogout.ts","turbopack:///[project]/src/lib/prisma.ts","turbopack:///[project]/src/actions/userDataCall.ts","turbopack:///[project]/src/app/activities/[id]/page.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/.next-internal/server/app/activities/[id]/page/actions.js (server actions loader)","turbopack:///[project]/src/app/actions/participation.ts"],"sourcesContent":["\"use server\";\n\nimport { cookies } from \"next/headers\";\n\nexport async function logoutUser() {\n  try {\n    // 쿠키에서 토큰 제거\n    const cookieStore = await cookies();\n    cookieStore.delete(\"token\");\n\n    console.log(\"로그아웃 성공\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"로그아웃 에러:\", error);\n    return { success: false, error: \"로그아웃 중 오류가 발생했습니다.\" };\n  }\n}\n","\nimport { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query', 'error', 'warn'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;","\"use server\";\n\nimport { cookies } from \"next/headers\";\nimport jwt from \"jsonwebtoken\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function getUser() {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(\"token\")?.value;\n    if (!token) {\n      return null;\n    }\n    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as {\n      userId: string;\n    };\n    \n    // ✅ user_id로 user_data 찾아서 실제 id 반환\n    const userData = await prisma.user_data.findUnique({\n      where: { user_id: decoded.userId },\n      select: { \n        id: true,           // ← 이게 중요!\n        user_name: true,\n        user_email: true,\n      },\n    });\n    \n    if (!userData) {\n      return null;\n    }\n    \n    return {\n      userId: userData.id,  // ✅ user_data.id 반환 (user_id 아님!)\n      userName: userData.user_name,\n      userEmail: userData.user_email,\n    };\n  } catch (error) {\n    console.error(\"Error in getUser:\", error);\n    return null;\n  }\n}\n\nexport async function getUserName() {\n  try {\n    const user = await getUser();\n    if (!user) {\n      return null;\n    }\n    return user.userName || null;\n  } catch (error) {\n    console.error(\"Error fetching user name:\", error);\n    return null;\n  }\n}","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/activities/[id]/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/activities/[id]/page.tsx\",\n    \"default\",\n);\n","export {logoutUser as '0033443898160a084cd7ef1392a40e07e0fc0f48b6'} from 'ACTIONS_MODULE0'\nexport {joinActivity as '40be8e21206f3852161d60a26fa3054a98435b8c1a'} from 'ACTIONS_MODULE1'\nexport {cancelParticipation as '40a67994b24109943393c40b6c4f8c165eb473b972'} from 'ACTIONS_MODULE1'\n","\"use server\";\n\nimport { prisma } from '@/lib/prisma';\nimport { revalidatePath } from 'next/cache';\nimport { getUser } from \"@/actions/userDataCall\";\n\n// 참여하기\nexport async function joinActivity(activityId: string) {\n  try {\n    const user = await getUser();\n    if (!user?.userId) {\n      return { success: false, error: \"로그인이 필요합니다.\" };\n    }\n\n    // 활동 확인\n    const activity = await prisma.activity.findUnique({\n      where: { id: activityId },\n      include: {\n        participations: true,\n      },\n    });\n\n    if (!activity) {\n      return { success: false, error: \"모임을 찾을 수 없습니다.\" };\n    }\n\n    // 작성자는 참여 불가\n    if (activity.userId === user.userId) {\n      return {\n        success: false,\n        error: \"본인이 작성한 모임에는 참여할 수 없습니다.\",\n      };\n    }\n\n    // 이미 참여했는지 확인\n    const existingParticipation = await prisma.participation.findUnique({\n      where: {\n        activityId_userId: {\n          activityId,\n          userId: user.userId,\n        },\n      },\n    });\n\n    if (existingParticipation) {\n      return { success: false, error: \"이미 참여한 모임입니다.\" };\n    }\n\n    // 정원 확인\n    if (activity.participants >= activity.maxParticipants) {\n      return { success: false, error: \"참여 인원이 마감되었습니다.\" };\n    }\n\n    // 참여 생성\n    await prisma.participation.create({\n      data: {\n        activityId,\n        userId: user.userId,\n      },\n    });\n\n    // 참가자 수 증가\n    await prisma.activity.update({\n      where: { id: activityId },\n      data: {\n        participants: {\n          increment: 1,\n        },\n      },\n    });\n\n    revalidatePath(`/activities/${activityId}`);\n    revalidatePath(\"/activities\");\n\n    return { success: true, message: \"모임에 참여했습니다!\" };\n  } catch (error) {\n    console.error(\"Join activity error:\", error);\n    return { success: false, error: \"참여에 실패했습니다.\" };\n  }\n}\n\n// 참여 취소\nexport async function cancelParticipation(activityId: string) {\n  try {\n    const user = await getUser();\n    if (!user?.userId) {\n      return { success: false, error: \"로그인이 필요합니다.\" };\n    }\n\n    const participation = await prisma.participation.findUnique({\n      where: {\n        activityId_userId: {\n          activityId,\n          userId: user.userId,\n        },\n      },\n    });\n\n    if (!participation) {\n      return { success: false, error: \"참여하지 않은 모임입니다.\" };\n    }\n\n    // 참여 삭제\n    await prisma.participation.delete({\n      where: {\n        id: participation.id,\n      },\n    });\n\n    // 참가자 수 감소\n    await prisma.activity.update({\n      where: { id: activityId },\n      data: {\n        participants: {\n          decrement: 1,\n        },\n      },\n    });\n\n    revalidatePath(`/activities/${activityId}`);\n    revalidatePath(\"/activities\");\n\n    return { success: true, message: \"참여를 취소했습니다.\" };\n  } catch (error) {\n    console.error(\"Cancel participation error:\", error);\n    return { success: false, error: \"취소에 실패했습니다.\" };\n  }\n}\n\n// 참여 여부 확인\nexport async function checkParticipation(activityId: string) {\n  try {\n    const user = await getUser();\n    if (!user?.userId) {\n      return { isParticipating: false };\n    }\n\n    const participation = await prisma.participation.findUnique({\n      where: {\n        activityId_userId: {\n          activityId,\n          userId: user.userId,\n        },\n      },\n    });\n\n    return { isParticipating: !!participation };\n  } catch (error) {\n    console.error(\"Check participation error:\", error);\n    return { isParticipating: false };\n  }\n}\n"],"names":[],"mappings":"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","ignoreList":[3]}